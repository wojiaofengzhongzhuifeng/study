# 曲库后端业务梳理

![image-20220306105624690](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220306105624690.png)

## 匹配服务



- 各种 id 解释
  - vid = youtubeId = externalId
  - spotifyId = externalSongId
  - trackId = 本司曲库 id 

- 预期效果

​	输入 VID, 返回 meta 信息, meta 信息包括 artist,album, 	song, lyric, 其中前三者的信息通过 spotify 获取, lyric 不知道

- 匹配正确率  vs 匹配成功率 ?
  成功率表示找**到**了

  正确率表示找**对**了

- VID 与 trackId 一一对应, 数据保存在 track 表

- 提取三段式信息的疑问

- 数据库汇总

  - MusicContentSeed.SongMapSeed

    关系表, 保存 youtubeId 与 spoyifyId 关系

  - MusicContentOps.SongMap

    关系表, 保存 youtubeId 与 trackId 关系

- 服务汇总

  - matrix-ytb-music-spider

    输入 vid , 输出三段式信息

  - ms-map-seed

    主要修改 songMapSeed table, 根据数据的 status 调用不同服务

    - PENGDING
      调用 matrix-ytb-music-spider/ytb-music-detail 爬虫服务, 尝试读取三段式信息, 另外如果发现 artist, album, song 都是空字符, 依然保持 PENDING
      - YOUTUBE_SUCCESS
        爬取三段式成功, 调用匹配服务 /ms-match-server/v1/spotify-track
        - SPOYIFY_SUCCESS
          匹配服务正常返回数据
      - YOUTUBE_FAILURE: 合集情况



## 歌词服务

## 工程实施出现的问题

### 问题定义

解决 270 https://docs.google.com/spreadsheets/d/1I0VPQtarYaKGvgpToTszoUFD22wsI2rWH0gBHXF4PcY/edit#gid=2020687655 YT 链接提取不到信息的问题

### 思路

通过以下三种方式分别提取信息(按照优先级从高到低排列)

https://docs.google.com/document/d/1ZYVfthAgAWmdvBAF4PAqtdawLUFiAspQVER5znE_3Ek/edit#heading=h.97fzulrhzifg

### 工程出现的问题和调整方法

- 「如果提取不到三段式, 需要重试」 [链接](https://docs.google.com/document/d/1W1C55PaFOCoIzIvVqCIKtQd_n2x-w8yUSYl3SBvfvIk/edit?disco=AAAAUs9vFvY)

  调整为: 如果提取不到三段式, 不重试, 直接走下面流程

- 3.4 的数据是不是直接拿 270 条没有三段式信息的数据, 结合 「match 服务-通过 YT 标题提取三段式信息」得到的数据? 如果是的话, 这个数据可能不准, 因为这样的步骤跳过了在爬虫阶段执行的提取 YT 手动输入信息和提取 YT 自动生成信息
  提取不到三段式的链接, 第一步应该经过提取 YT 手动输入信息和提取 YT 自动生成信息, 如果这两步都提取不到, 才通过标题提取, 目前 python 那边数据没有跑, 代码也有些错误, 需要**使用新策略, 跑数据, 然后修改 python 代码, 最后的预期是: 使用这个 [270](https://docs.google.com/spreadsheets/d/1I0VPQtarYaKGvgpToTszoUFD22wsI2rWH0gBHXF4PcY/edit#gid=2020687655) 数据跑结果, 检查机器与人工跑出来的 spotifyId, 并且会在表格把提取到的三段式信息展示, 供 mana 继续调整策略**

  



解决 277 YT 条提取信息不到的问题




## webpack ç›´æ’­



### babel æ‰§è¡Œè¿‡ç¨‹

1. parseï¼šå°†åŸå§‹ code è½¬åŒ–ä¸º AST
2. traverseï¼šéå† AST è¿›è¡Œä¿®æ”¹ AST2
3. generateï¼šæŠŠAST2 å˜æˆ code2

åŸå§‹ code -----> ASTï¼ˆå¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡è¡¨ç¤ºåŸå§‹ codeï¼‰ -----> AST2ï¼ˆç»è¿‡ä¿®æ”¹åçš„ ASTï¼‰ ------> ç¼–è¯‘åçš„ code2

---

### babelçš„ä½œç”¨

**åˆ†æä¾èµ–**

---

### é™æ€åˆ†æ === ä¸éœ€è¦æ‰§è¡Œä»£ç 

---

### å¦‚ä½•åœ¨ç°ä»£æµè§ˆå™¨ç›´æ¥ä½¿ç”¨ export import è¯­æ³•ï¼Ÿ

---

### webpack å¯ä»¥åŠ è½½ css ï¼Œå®é™…æ˜¯å°† css æ–‡ä»¶çš„å†…å®¹å€ŸåŠ© jsï¼Œé€šè¿‡ style çš„æ–¹å¼æ’å…¥åˆ° html

---

### æ–°çŸ¥è¯†ï¼šcss-loader ä¸ style-loader çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

- css-loader çš„ä½œç”¨æ˜¯å°† css æ–‡ä»¶è½¬åŒ–ä¸º js å­—ç¬¦ä¸²
- style-loader çš„ä½œç”¨æ˜¯å°† js å­—ç¬¦ä¸²æ”¾åˆ° style æ ‡ç­¾ä¸­
- loader å°±æ˜¯ä¸€ä¸ªtransform å‡½æ•°
- loader çš„ä½œç”¨å°±æ˜¯æŠŠæ–‡ä»¶è½¬åŒ–ä¸ºå¯ä»¥è¿è¡Œçš„ js
- 

---

### æ€è€ƒé¢˜ï¼š

![image-20221013193155474](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221013193155474.png)

---

### html-webpack-plugin ä½œç”¨

- è‡ªåŠ¨ç”Ÿæˆ HTML 
- å°†æ„å»ºåçš„ js æ–‡ä»¶å¼•å…¥åˆ°è‡ªåŠ¨ç”Ÿæˆçš„ HTML æ–‡ä»¶ä¸­
- é€šè¿‡ htmlWebpackPlugin å®šä¹‰å‚æ•°ï¼Œç„¶åé€šè¿‡æ¨¡æ¿è¯­æ³•çš„æ–¹å¼å°†å‚æ•°ä¼ å…¥åˆ° html ä¸­

---

### webpack-dev-serverä½œç”¨

å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œæ„å»ºäº§ç‰©å­˜åœ¨å†…å­˜ä¸­ï¼Œæé«˜æ„å»ºé€Ÿåº¦ï¼Œä¹Ÿå¯è®¾ç½®ä»£ç†æœåŠ¡ç«¯æ¥å£ï¼Œè§£å†³è·¨åŸŸé—®é¢˜

---

### æœ€ç®€å•çš„ loaderï¼š txt-loader

ä½¿ç”¨nodejs è¯»å–æ–‡ä»¶ï¼Œå†å°†æ–‡ä»¶å†…å®¹è½¬åŒ–ä¸º js æ–‡ä»¶å†…å®¹

```
// txt-loader å®ç°, ä½¿ç”¨ node
module.exports = function(src) {
  return `module.exports = '${src}'`;
}
```

```
// webpack.config.js
{ 
      test: /\.txt$/, 
      use: [
        {loader: './myloader.js'},
      ],
 },
```

---

### çƒ­æ›´æ–°çš„åŸç†

- ç›‘å¬ï¼šæœ¬åœ°æ–‡ä»¶é€šè¿‡webpack-dev-middlewareç›‘å¬ä¿®æ”¹åŠ¨ä½œï¼ˆcompiler.watchï¼‰ï¼Œç„¶åè§¦å‘webpacké‡æ–°æ„å»ºç¼–è¯‘
- é•¿è¿æ¥ï¼šæ–‡ä»¶æ„å»ºåç”Ÿæˆä¸åŒçš„hashå€¼æ ‡è¯†æ¯ä¸€æ¬¡ç¼–è¯‘ï¼ˆä¸åŒæ–‡ä»¶æˆ–æ¨¡å—ä¹Ÿå¯ä»¥å•ç‹¬æ‹¥æœ‰è‡ªå·±çš„hashï¼‰ï¼Œé€šè¿‡ websocket é•¿è¿æ¥å®ç°ä¸æµè§ˆå™¨é€šä¿¡ï¼Œå‘Šè¯‰éœ€è¦æ›´æ–°æ–°çš„èµ„æº
- å±€éƒ¨æ›´æ–°ï¼šæµè§ˆå™¨æ”¶åˆ°æ›´æ–°çš„ä¿¡æ¯åï¼Œå¯¹domè¿›è¡Œå±€éƒ¨æ›´æ–°

---

### plugin å®ç°

```
const fs = require('fs')
const path = require('path')
class myPlugin {
  constructor (options) {
    this.options = options // è¯»å–ç”¨æˆ·çš„å‚æ•°
  }

	// è¿™ä¸ªå‡½æ•°åç§°æ˜¯å›ºå®šçš„
  apply(compiler) {
    compiler.hooks.emit.tap('myPlugin', () => {
      fs.writeFile(path.resolve(__dirname, '../../dist/myPlugin.html'), "<div>ä½ å¥½å•Š</div>", (err) => {
        if(err) {
            return console.log(err);
        }
        console.log("The file was saved!");
      });
    });
    compiler.hooks.done.tap('myPlugin', (err) => {
      console.log("-------------------æ„å»ºå®Œæˆäº†---------------")
    });
    compiler.hooks.compile.tap('myPlugin', () => {
      console.log("-------------------å¼€å§‹æ„å»ºæ’ä»¶---------------")
    });
  }
}
module.exports = myPlugin;

```

é™„å¸¦ plugin çš„ç”Ÿå‘½å‘¨æœŸ

![image-20221015093129848](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221015093129848.png)

---

### htmlwebpackplugin å®ç°ä¸€ä¸‹

- æŠŠç‰ˆæœ¬ï¼Œç¼–è¯‘ä¿¡æ¯ï¼Œç½‘ç«™ä¿¡æ¯åŠ è¿›å»
- æ³¨å…¥ç‰¹å®šçš„ script æ ‡ç­¾ï¼Ÿ

---

### commonjs æ— æ³• tree shaking åŸå› 

CommonJS æ¨¡å—çš„è¿™ç§åŠ¨æ€æ€§è´¨æ„å‘³ç€æ— æ³•åº”ç”¨ Tree Shakingï¼Œå› ä¸ºåœ¨å®é™…è¿è¡Œä»£ç ä¹‹å‰æ— æ³•ç¡®å®šéœ€è¦å“ªäº›æ¨¡å—ã€‚æ¯”å¦‚å¯ä»¥åœ¨if-elseä¸­ä½¿ç”¨ requireï¼Œè¿™æ˜¯è¿è¡Œæ—¶çŠ¶æ€

---

### **webpack æ‰“åŒ…ä¼˜åŒ–**

modeè®¾ç½®ã€æ’é™¤nodemodulesã€åˆ†åŒ…ï¼ˆvendorã€å…¬å…±æ¨¡å—æå–ï¼‰ã€ç¼“å­˜ã€å‹ç¼©ã€å›¾ç‰‡base64ã€æ‡’åŠ è½½import()ã€‚æˆ–è€…ä»ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒåˆ†å¼€è®²è§£

---

### **å¸¸ç”¨æ’ä»¶å’Œloaderï¼Œä»¥åŠæ’ä»¶å’ŒloaderåŒºåˆ«æ˜¯ä»€ä¹ˆ**

å…³é”®è¯ï¼šloader-ä»…æ–‡ä»¶å¤„ç†ã€æ’ä»¶-å¯¹æ•´ä¸ªæ„å»ºè¿‡ç¨‹è¿›è¡Œæ‰©å±•

- raw-loaderï¼šåŠ è½½æ–‡ä»¶åŸå§‹å†…å®¹ï¼ˆutf-8ï¼‰
- file-loaderï¼šæŠŠæ–‡ä»¶è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ä»£ç ä¸­é€šè¿‡ç›¸å¯¹ URL å»å¼•ç”¨è¾“å‡ºçš„æ–‡ä»¶ (å¤„ç†å›¾ç‰‡å’Œå­—ä½“)
- url-loaderï¼šä¸ file-loader ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯ç”¨æˆ·å¯ä»¥è®¾ç½®ä¸€ä¸ª[é˜ˆå€¼](https://so.csdn.net/so/search?q=é˜ˆå€¼&spm=1001.2101.3001.7020)ï¼Œå¤§äºé˜ˆå€¼æ—¶è¿”å›å…¶ publicPathï¼Œå°äºé˜ˆå€¼æ—¶è¿”å›æ–‡ä»¶ base64 å½¢å¼ç¼–ç  (å¤„ç†å›¾ç‰‡å’Œå­—ä½“)
- source-map-loaderï¼šåŠ è½½é¢å¤–çš„ Source Map æ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿æ–­ç‚¹è°ƒè¯•
- svg-inline-loaderï¼šå°†å‹ç¼©åçš„ SVG å†…å®¹æ³¨å…¥ä»£ç ä¸­
- image-loaderï¼šåŠ è½½å¹¶ä¸”å‹ç¼©å›¾ç‰‡æ–‡ä»¶
- json-loader åŠ è½½ JSON æ–‡ä»¶ï¼ˆé»˜è®¤åŒ…å«ï¼‰
- handlebars-loader: å°† Handlebars æ¨¡ç‰ˆç¼–è¯‘æˆå‡½æ•°å¹¶è¿”å›
- babel-loaderï¼šæŠŠ ES6 è½¬æ¢æˆ ES5
- ts-loader: å°† TypeScript è½¬æ¢æˆ JavaScript
- awesome-typescript-loaderï¼šå°† TypeScript è½¬æ¢æˆ JavaScriptï¼Œæ€§èƒ½ä¼˜äº ts-loader
- sass-loaderï¼šå°† CSS ä»£ç æ³¨å…¥ JavaScript ä¸­ï¼Œé€šè¿‡ DOM æ“ä½œå»åŠ è½½ CSS
- css-loaderï¼šåŠ è½½ CSSï¼Œæ”¯æŒæ¨¡å—åŒ–ã€å‹ç¼©ã€æ–‡ä»¶å¯¼å…¥ç­‰ç‰¹æ€§
- style-loaderï¼šæŠŠ CSS ä»£ç æ³¨å…¥åˆ° JavaScript ä¸­ï¼Œé€šè¿‡ DOM æ“ä½œå»åŠ è½½ CSS
- postcss-loaderï¼šæ‰©å±• CSS è¯­æ³•ï¼Œä½¿ç”¨ä¸‹ä¸€ä»£ CSSï¼Œå¯ä»¥é…åˆ autoprefixer æ’ä»¶è‡ªåŠ¨è¡¥é½ CSS3 å‰ç¼€
- eslint-loaderï¼šé€šè¿‡ ESLint æ£€æŸ¥ JavaScript ä»£ç 
- tslint-loaderï¼šé€šè¿‡ TSLintæ£€æŸ¥ TypeScript ä»£ç 
- mocha-loaderï¼šåŠ è½½ Mocha æµ‹è¯•ç”¨ä¾‹çš„ä»£ç 
- coverjs-loaderï¼šè®¡ç®—æµ‹è¯•çš„è¦†ç›–ç‡
- vue-loaderï¼šåŠ è½½ Vue.js å•æ–‡ä»¶ç»„ä»¶
- i18n-loader: å›½é™…åŒ–
- cache-loader: å¯ä»¥åœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„ Loader ä¹‹å‰æ·»åŠ ï¼Œç›®çš„æ˜¯å°†ç»“æœç¼“å­˜åˆ°ç£ç›˜é‡Œ



- define-pluginï¼šå®šä¹‰ç¯å¢ƒå˜é‡ (Webpack4 ä¹‹åæŒ‡å®š mode ä¼šè‡ªåŠ¨é…ç½®)
- ignore-pluginï¼šå¿½ç•¥éƒ¨åˆ†æ–‡ä»¶
- html-webpack-pluginï¼šç®€åŒ– HTML æ–‡ä»¶åˆ›å»º (ä¾èµ–äº html-loader)
- web-webpack-pluginï¼šå¯æ–¹ä¾¿åœ°ä¸ºå•é¡µåº”ç”¨è¾“å‡º HTMLï¼Œæ¯” html-[webpack](https://so.csdn.net/so/search?q=webpack&spm=1001.2101.3001.7020)-plugin å¥½ç”¨
- uglifyjs-webpack-pluginï¼šä¸æ”¯æŒ ES6 å‹ç¼© (Webpack4 ä»¥å‰)
- terser-webpack-plugin: æ”¯æŒå‹ç¼© ES6 (Webpack4)
- webpack-parallel-uglify-plugin: å¤šè¿›ç¨‹æ‰§è¡Œä»£ç å‹ç¼©ï¼Œæå‡æ„å»ºé€Ÿåº¦
- mini-css-extract-plugin: åˆ†ç¦»æ ·å¼æ–‡ä»¶ï¼ŒCSS æå–ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½ (æ›¿ä»£extract-text-webpack-plugin)
- serviceworker-webpack-pluginï¼šä¸ºç½‘é¡µåº”ç”¨å¢åŠ ç¦»çº¿ç¼“å­˜åŠŸèƒ½
- clean-webpack-plugin: ç›®å½•æ¸…ç†
- ModuleConcatenationPlugin: å¼€å¯ Scope Hoisting
- speed-measure-webpack-plugin: å¯ä»¥çœ‹åˆ°æ¯ä¸ª Loader å’Œ Plugin æ‰§è¡Œè€—æ—¶ (æ•´ä¸ªæ‰“åŒ…è€—æ—¶ã€æ¯ä¸ª Plugin å’Œ Loader è€—æ—¶)
- webpack-bundle-analyzer: å¯è§†åŒ– Webpack è¾“å‡ºæ–‡ä»¶çš„ä½“ç§¯ (ä¸šåŠ¡ç»„ä»¶ã€ä¾èµ–ç¬¬ä¸‰æ–¹æ¨¡å—)

---

### ç–‘é—®ï¼š å‰ç«¯é¡¹ç›®ä¸­ ï¼Œnodejs ä¸å‰ç«¯é¡¹ç›®çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ



---



## ä½œä¸š



### è‡ªå·±ä»0-1é…ç½®æ­å»ºä¸€ä¸ªwebpack+vue æˆ– webpack+react é¡¹ç›®å·¥ç¨‹å‡ºæ¥ï¼Œä¸ä½¿ç”¨vueè„šæ‰‹æ¶



#### node æ–‡ä»¶è·¯å¾„ç³»ç»Ÿ?

![image-20221022102503967](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221022102503967.png)

ğŸ”´ ç»Ÿä¸€ä½¿ç”¨ç¬¬å››ç§æ–‡ä»¶è·¯å¾„ï¼Œå°è¯•æŠŠ webpack.config.js ä»__dirname =>  __dirname/config/ï¼Œçœ‹ä¸‹æ˜¯å¦å¾—åˆ°ç›¸åŒçš„è·¯å¾„

---



#### ä½¿ç”¨ babel å¤„ç† tsx ï¼Œå¦‚ä½•é…ç½®ï¼Ÿbabel çš„å¤„ç†æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ

---

#### extensionsçš„ä½œç”¨=> ä¸éœ€è¦åœ¨å¼•å…¥çš„åœ°æ–¹æŒ‡å®šåç¼€



---

#### webpack-dev-server çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¯åŠ¨åçš„æœåŠ¡çš„æ–‡ä»¶æ”¾åœ¨å“ªé‡Œï¼Ÿ

å¯åŠ¨ web æœåŠ¡å™¨ï¼Œä¸ build çš„ç»“æœä¸€è‡´ï¼Œæ–‡ä»¶ä¿å­˜åˆ°å†…ä¸­

![image-20221022105838418](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221022105838418.png)

---

#### ç¯å¢ƒå˜é‡ set/get

- ä½œç”¨

  åœ¨ package.json script è®¾ç½®å˜é‡ï¼Œåœ¨å·¥ç¨‹ä»£ç å’Œä¸šåŠ¡ä»£ç è¯»å–è®¾ç½®çš„å˜é‡

- setï¼šä¸€èˆ¬é€šè¿‡ cross-env åŒ…å…¼å®¹ï¼Œç„¶ååœ¨ package.json çš„ script è®¾ç½®

  `cross-env test123321=test123321111`

- get

  - åœ¨ webpack.config.js ä¸­

    `console.log(console.log('test123321', process.env.test123321))`

  - åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œéœ€è¦å€ŸåŠ© webpack.DefinePlugin æ’ä»¶ï¼Œå°† webpack.config.js çš„å˜é‡ï¼ŒåŒæ—¶åœ¨ä¸šåŠ¡ä»£ç è¯»å–

    - å®šä¹‰ plugin

      ```
      new webpack.DefinePlugin({
       'test123321': JSON.stringify(process.env.test123321) // å¿…é¡»æœ‰ JSON.stringify
      })
      ```

    - åœ¨ä¸šåŠ¡ä»£ç ä½¿ç”¨å˜é‡

      ````
      console.log('test123321', test123321)
      ````

---

#### ä½¿ç”¨ css-loader å¤„ç†åçš„ css æ–‡ä»¶é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ



---

#### ä½¿ç”¨ babel-loader å¤„ç†åçš„js æ–‡ä»¶é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ



```
// babel.config.js
module.exports = {
  // æ‰§è¡Œé¡ºåºç”±å³å¾€å·¦,æ‰€ä»¥å…ˆå¤„ç†ts,å†å¤„ç†jsx,æœ€åå†è¯•ä¸€ä¸‹babelè½¬æ¢ä¸ºä½ç‰ˆæœ¬è¯­æ³•
  "presets": [
    [
      "@babel/preset-env",
      {
        // è®¾ç½®å…¼å®¹ç›®æ ‡æµè§ˆå™¨ç‰ˆæœ¬,è¿™é‡Œå¯ä»¥ä¸å†™,babel-loaderä¼šè‡ªåŠ¨å¯»æ‰¾ä¸Šé¢é…ç½®å¥½çš„æ–‡ä»¶.browserslistrc
        // "targets": {
        //  "chrome": 35,
        //  "ie": 9
        // },
        "useBuiltIns": "usage", // æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹,ä»¥åŠä»£ç ä¸­ä½¿ç”¨åˆ°çš„apiè¿›è¡Œå¼•å…¥polyfillæŒ‰éœ€æ·»åŠ 
        "corejs": 3 // é…ç½®ä½¿ç”¨core-jsä½¿ç”¨çš„ç‰ˆæœ¬
      }
    ],
    "@babel/preset-react",
    "@babel/preset-typescript"
  ]
}
```



---

#### babel å¤„ç† js ï¼Œå®‰è£…çš„åŒ…ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

![image-20221022120651929](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221022120651929.png)

---

#### å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒå¦‚ä½•å¤„ç†å›¾ç‰‡èµ„æºï¼Ÿ

- å¼€å‘ç¯å¢ƒ

  ![image-20221022123518621](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221022123518621.png)

- ç”Ÿäº§ç¯å¢ƒ

  ![image-20221022123812136](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20221022123812136.png)

---







æç¤ºï¼švueå…¶å®å°±æ˜¯ä¸€ä¸ªnpmæ¨¡å—ï¼Œç„¶åå¯¹äºwebpackæ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å¤šè§£æä¸€ç§.vueåç¼€çš„æ–‡ä»¶ï¼Œè€Œé™¤äº†jsåç¼€çš„æ–‡ä»¶ï¼Œå…¶ä»–ç±»å‹éƒ½å€ŸåŠ© loader å³å¯ï¼Œä¹Ÿå°±æ˜¯å¤šåŠ è½½ä¸€ç§ vue çš„ loaderã€‚



2ã€å‚ç…§webpackå®˜ç½‘apiè‡ªå·±å†™ä¸€ä¸ªèµ„æºæ‹·è´æ’ä»¶å‡ºæ¥ï¼Œé€šè¿‡ä¼ å…¥çš„æ–‡ä»¶ç›®å½•ï¼Œæ„å»ºæ—¶å°†å…¶æ‹·è´åˆ°distç›®å½•ï¼Œç±»ä¼¼ç®€ç‰ˆçš„ copy-webpack-pluginï¼ˆå»ºè®®äº†è§£nodeçš„fsæ¨¡å—ã€fs-extraæ¨¡å—ï¼‰

æˆ–è€…  html-webpack-plugin




# Event Loop

## 任务分类

- microTask：①process.nextTick②promise.then()

- macroTask: ①setTimeout②setInterval③setImmediate

## 执行原则

- 先执行 microTask 后执行 macroTask

### 示例代码

```javascript
console.log('main1');

process.nextTick(function() {
    console.log('process.nextTick1');
});

setTimeout(function() {
    console.log('setTimeout');
    process.nextTick(function() {
        console.log('process.nextTick2');
    });
}, 0);

new Promise(function(resolve, reject) {
    console.log('promise');
    resolve();
}).then(function() {
    console.log('promise then');
});

console.log('main2');

```


```javascript
setTimeout(()=>{
  setImmediate(()=>{
    console.log("1")
    setTimeout(()=>{
      console.log("2")
    }, 0)
  })

  setTimeout(()=>{
    console.log('3');
    setImmediate(()=>{
      console.log('4');
    })
  }, 0)
}, 1000)
```






```javascript
console.log('a');
setTimeout(() => {
    console.log('b');
}, 0);
console.log('c');
Promise.resolve().then(() => {
    console.log('d');
})
.then(() => {
    console.log('e');
});
console.log('f');

/*
重点：

执行完微任务 console.log("d") 后

立即向微任务队列中添加微任务 console.log("e")，紧接着执行微任务 console.log("e")。

并不是先执行宏任务 console.log("b")
* */
```





```javascript
async function async1(){
  console.log(1)
  // A，使用 async
  /*
  await async2()
  console.log(2)
  setTimeout(()=>{
    console.log(6)
  }, 0)
  */
  async2().then(()=>{
    console.log(2)
    setTimeout(()=>{
      console.log(6)
    }, 0)
  })
}

async function async2(){
  console.log(3)
}

async1()

new Promise(function(resolve){
  console.log(4)
  resolve()
}).then(()=>{
  console.log(5)
})

/*
1. await 后面的代码，全是 then 的内容

   ``` JavaScript
   // A async 代码
   await async2()
   console.log(2)
   setTimeout(()=>{
    console.log(6)
   }, 0)
   
   // 转化成 promise 的代码
   async2().then(()=>{
     console.log(2)
     setTimeout(()=>{
       console.log(6)
     }, 0)
   })
   2. 遇到 async2，直接执行即可(同步)
```






## 2022.09.01 周四

### todo

- 完善研发环境
- 使用包的接口，检查查询参数是否正确，检查是否展示足够的数据
- status 状态显示

---

### 完善研发环境

- 本地开发，不接入 auth0

  - 现象

    访问 http://localhost:3041/meta/batch-distribution， 结果重定向到 http://localhost:3041/login 现在想把这个重定向的代码在开发环境取消生效

  - 原因

  - 解决方法

- 解决 console 行数错误问题

---

### lyric batch management 新增 Drawer 抽屉组件

- 可以跨页选择歌曲

---

### 后台管理系统 - 包新增歌曲总数

- 需要根据 list 生成多个 promise ， 注意与 pormise + 判断区分

---

### 页面设置 no-index 响应 header

```
<meta name="robots" content="noindex,nofollow" />
```

```
add_header X-Robots-Tag "noindex, nofollow" always; 
```

php url 包含 xxx

https://gitlab.mobiuspace.net/mobiuspace/fe-team/wordpress-eks/-/blob/master/wordpress/wp-content/themes/dywx/header.php#L10

---

### 处理react 重复错误

```
Warning: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
```

新增 alias

```
alias: {
  react: path.resolve('./node_modules/react')
}
```

---

## 2022.09.02 周五

### todo

- 

---

### wordpress php 

- 获取当前 url

```
$url = get_site_url();
访问 https://www.snaptubear.com/faq/， $url = https://www.snaptubear.com/faq/
访问 https://www.snaptubear.com/faq/2022/08/18/hello-world/ ，https://www.snaptubear.com/faq/
```

- 获取域名 url

---





## 2022.09.05 周一



### 周计划

- 完成评论调研
  - 核心是爬虫能力的实现；
  - 其次需要使用任务表管理爬虫任务，总共需要两张表：songComment + songCommentTask
  - 本周希望能产出 excel 表格，每张表是 top 1k 的歌曲评论数据
- 后台优化
- 【学习】补充笔记
- 下载站代码优化

---

### bug：打包出现错误

- bug：打包出现错误

  - 现象

    ![image-20220905093840971](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220905093840971.png)

  - 原因

  - 解决方法

  - 测试

  - 其他资源

    https://gitlab.mobiuspace.net/mobiuspace/fe-team/fe-snaptube-website/-/jobs/410899#L108

    

---

### 功能：比较不同版本

- 预期结果

  歌词制作工具新增一个路由 versionDiff，根据 lyricSpiderRecordId 得到不同的歌词数据，并且展示

- 实施

  - effect

    lyricSpiderRecordId 变化时：发起请求

- 测试

---

###新知识：编写健壮性代码 - 读取数组 / 点操作

- demo - 读取数组

  ```
  const list = [{a: 1}, {a: 2}]
  // 需求是读取 list item 的 a ，正常肯定这样读取
  let firstItem = list[0].a
  let secondItem = list[1].a
  
  // 但是考虑到 list 可能是这样的const list = [{a: 1}] 使用上面的代码读取，会抛出错误
  let firstItem = list[0]?.a || 0
  let secondItem = list[1]?.a || 0
  ```

- demo - 点操作

  ```
  const response = {
  	message: 'success',
  	data: {
  		data: {
  			spotifySong: " All Too Well"
  		}
  	}
  }
  // 需求是读取 spotifySong 的数据，可能这样写
  const spotifySong = response.data.data.spotifySong || ''
  // 这样写才是对的
  const spotifySong = response?.data?.data?.spotifySong || ''
  ```

---

### 功能：使用 puppeteer 获取评论数据

- 使用 puppeteer  获取 html 

- url 变化

  - 查询专辑 https://genius.com/search?q=Un%20Verano%20Sin%20Ti
  - 进入专辑详情： https://genius.com/albums/Bad-bunny/Un-verano-sin-ti
  - 进入歌曲详情：https://genius.com/Bad-bunny-and-chencho-corleone-me-porto-bonito-lyrics
  - 以上是进入 genius 歌曲详情的流程，下面是在歌曲详情中爬取评论数据的过程

- 因为genius 是客户端渲染的，即 html 的内容，部分通过 js 生成，因此直接在 html 无法寻找相应数据

  - 在浏览器中，通过搜索「Search Result Tap」，可以找到相应内容；但是通过 apifox ，在返回的 html 中，找不到「Search Result Tap」，由此说明 「Search Result Tap」是通过 js 动态生成的，
  - 因此，现在有解决方法是：
    - 只加载 htlm  + js ，其余不加载

  ![image-20220905153436136](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220905153436136.png)
  ![image-20220905153543827](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220905153543827.png)

---

### 新知识：检查字符串 1 是否在字符串数组2内

```javascript
// stringList2: ['baidu.com', 'google.com']
// string1: https://www.baidu.com
function stringInStringList(string, stringList){
	let isIncludes = false
	for(let stringItem of stringList){
		if(stringItem.includes(string) || string.includes(stringItem)){
      isIncludes = true
      break
    }
	}
  return isIncludes
}
console.log(stringInStringList('https://www.baidu.com', ['baidu.com', 'google.com']))
```

---

### 新知识： 如何使用 puppeteer 加载指定优先级（priority）的资源

- 需求

  只想加载高 + 最高优先级资源，其他优先级资源不加载

- 找了 api ，发现没有这个数据

---

### 




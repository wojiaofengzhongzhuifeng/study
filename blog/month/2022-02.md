## 2022.02.21



---

### todo 

- songmap 数据库添加 type，version 字段，现有的数据如何处理？需要刷一遍数据库？
- 



---



### 理解歌词分发业务的逻辑

- TrackLyric 与 LyricMap 区别是什么？

- 本周工作：/ms-ops-app-server/v2/songs/info 接口，应该已经弄完了，还需要做什么 

  - 区分 v1 v2 接口的作用是为了使用不同数据

- 操作 LyricMap 关系表接口

  - 增操作：歌词映射服务 API 设计 -> 新增歌词映射信息
  - 本周工作：查操作：歌词映射服务 API 设计-> 根据 VID 获取歌词映射信息

- 操作 LRCLyric 与 TXTLyric 表接口

  - 增操作：歌词运营服务 API 设计 -> 新增动态(静态)歌词
  - 改操作：歌词运营服务 API 设计 -> 修改动态(静态)歌词
  - 查操作：曲库歌词服务 API 设计 -> 获取动态(静态)歌词信息

  

---

### 接口：客户端 API 设计 -> 获取歌词信息

- 歌曲文件的 referrer_url 是什么？

- 接口调用过程

  - trackId -> contentSeed.ddexSongMeta 表根据 id 返回

    - artists字段的值有没有多个 artists 的情况？

    - artists.id -> 简单

    - artists.artistName -> 简单

    - artists.coverUrl -> 使用 artists.id ，在 content.ddexArtist 返回 coverUrl

    - artists.action -> 使用 artists.id 拼接固定字符串生成

    - ---

    - album.id-> 简单

    - album.albumName -> 简单

    - album.coverUrl -> 简单

    - album.action-> 使用 album.id 拼接固定字符串生成

    - ---

    - lyrics.id -> 获取 externalId -> 在 lyricMap 表，使用接口 「根据 VID 获取歌词映射信息」返回 TXTLyricId，LRCLyricId

    - lyrics.lyricUrl -> 在 LRCLyric， TXTLyric 表，根据 TXTLyricId，LRCLyricId 返回 s3Key 拼接固定字符串生成

    - lyrics.type -> 在 LRCLyric 表返回的数据，标记为 LRC

    - ---

    - copyrightSign ?

    - songId -> 简单

    - songName -> 简单

    - playUrl -> 简单

  - 

---

### 本周工作

- 创建 MusicContent.LRCLyric， MusicContent.TXTLyric，MusicContent.TrackLyric，MusicContentOps.lyricMap， 表 -> 索引 主键
- 完成接口「客户端 API 设计 -> 获取歌曲信息」
- 完成接口「歌词映射服务 API 设计-> 根据 VID 获取歌词映射信息」
- 完成接口 获取歌词 ？
- 使用 SQL 注入数据，等待下周客户端上线
- 提前完成剩余接口

---

### 如何保证生产环境的 SQL 不会错误？

- 在本地，通过 java 代码生成表
- 使用 navicat 自动生成表的 SQL 
- 将生成表的 SQL 进行在生产环境执行







---

'findById(Integer)' in 'com.example.study.dao.TrackDao' clashes with 'findById(ID)' in 'org.springframework.data.repository.CrudRepository'; attempting to use incompatible return type



spring.datasource.url=jdbc:mysql://localhost:3306/test
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.jdbc.Driver





org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'trackDao' defined in com.example.study.dao.TrackDao defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Invocation（调用） of init method failed; nested exception is java.lang.IllegalArgumentException: Not a managed type: class com.example.study.model.Track





I/O error on GET request for "http://localhost:9092/matrix-music-content-read-server/v1/songs/external-song-id": Connect to localhost:9092 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused



---

### sp 自动创建数据库方法

- 想连接 studytest 数据库
  ![image-20220221162155835](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220221162155835.png)
- 运行后，如果发现没有 studytest 数据库，会自动创建

---

### sp 自动创建表方法

![image-20220221165448465](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220221165448465.png)

---

### sp 目录文件结构

- controller
- service
- dao 数据持久层
- model（entity）-> 通过定义对象的方式，定义数据库表的字段



---











## 2022.02.19

### 请求参数的分类

- GET 参数
  - /student/1 => @PathVariable
  - /student?id=2 => @RequestParam
- POST 参数
  - {"a": 1, "b": 2} => @RequestBody
- Integer vs int id ？
- dto => req 类
- vo => 
- AlbumController.java 调用
- **dto 为什么还要 new ，直接使用不行吗？**
- 不允许 post 参数的 a 为 null，如何处理？
- 









---



- 





## 2022.02.18





---



### java 包 1 调用包 2

- 在 包 2 mvn clean install 在控制台获取版本
  ![image-20220218140536398](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220218140536398.png)
- 在包 1 修改包 2 的版本号 执行 mnv install 
  ![image-20220218142126889](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220218142126889.png)
- 如果没有问题，提交包 2 的版本到 gitlab， 点击红框，并且在 gitlab 控制台获取线上版本号
  ![image-20220218140650751](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220218140650751.png)
- 在包 1 使用线上版本号

---

### 

---


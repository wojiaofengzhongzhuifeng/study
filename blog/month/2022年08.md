## 2022.08.01 周一

### todo

- ✅ OKR
- 计划本 Q 
- 简单实施文档
- ✅ console 合规化
- ✅ 如何找到 cdn 资源对应的桶位置？

---

### 计划本 Q4

学会东西：

- 爬取评论能力
- sprintboot 后台管理系统

每周计划：

- 8 月第一周(W31)
  - 数据看板开发1/2
  - 【学习计划】简单的实施文档
  - 【学习计划】nest 增删改查，单表
  - 【学习计划】sprint boot 增删改查，单表
  - 【学习计划】准备 sprint boot 的开发
- 8 月第二周(W32)
  - 数据看板开发2/2
  - 【学习计划】看典型代码
  - 【学习计划】看典型代码
- 8 月第三周(W33)
  - 输出评论实施文档
  - 【学习计划】看典型代码
- 8 月第四周(W34)
  - 完成增删改查接口 1/2 
- 8 月第五周(W35)
  - 完成增删改查接口 2/2 
- 9 月第一周(W36)
  - 歌曲爬取 1/3 
- 9 月第二周(W37)
  - 歌曲爬取 2/3
- 9 月第三周(W38)
  - 歌曲爬取 3/3
  - 联通爬取和增删改查接口
    - 需要新增工作表，用于管理歌曲评论入库
    - 至少需要完成[第一个业务接口](https://docs.google.com/document/d/1J2RXijTApUWhImh_rHGaVxd4V20UxhgATAAd4ST0qnE/edit#heading=h.er7x4h8fh7fe)
- 9 月第四周(W39)
  - 前端开发 1/2
- 10 月第一周(W40)
  - 放假
- 10 月第二周(W41)
  - 前端开发 2/2
- 10 月第三周(W42)
  - 评论数据看板
- 10 月第四周(W43)

重要节点：

- 08.11 数据看板完成
- 08.18 评论实施文档
- 09.01 评论数据增删改查接口 （sprint boot）
- 09.15 爬取接口
- 09.22 爬虫 + 增删改查接口一起使用，跑出原数据
- 10.13 上线前端界面
- 10.20 or 10.27 上线评论的数据看板

问题：

- 典型代码推荐？

- 需要引入包的流程？

- 数据库，应该设计成单表还是多表？

  - 多表

    song_comment_map

    id / youtubeId / commentId / status

    comment

    id / likeNumber / username / avatarUrl

  - 单表

    song_comment

    id / youtubeId / status / likeNumber / username / avatar

- 如果新增字段，哪种表更好？



---

### 简单实施文档

https://docs.google.com/document/d/1J2RXijTApUWhImh_rHGaVxd4V20UxhgATAAd4ST0qnE/edit#heading=h.wu6l34v8tkr7



---



### 【新知识】如何找到 cdn 资源对应的桶位置？

- 需求：需要对官网图片进行替换

  ![image-20220801115133797](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220801115133797.png)

- 实现步骤

  - 复制域名

    static.snaptube.in

  - 在 https://us-east-1.console.aws.amazon.com/cloudfront/v3/home?region=us-east-1#/distributions 使用域名进行搜索，得到源

    ![image-20220801115249641](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220801115249641.png)

  - 复制源的部分内容

    us-east-web-static

    在 https://s3.console.aws.amazon.com/s3/buckets?region=us-east-1&region=us-east-1 进行搜索，得到桶

    ![image-20220801115348939](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220801115348939.png)

    

## 2022.08.01 周二

### todo

- ✅ 评论实施文档 、 【新思路】excel 模拟演示数据库 、 使用 nest 完成开发 1/2
- ✅ AUDIT_AFTER_EDIT 处理
- ✅ 上线权限
- ✅ 数据看板需求

---

### 评论实施文档 、 excel 模拟演示数据库 、 使用 nest 完成开发

- 【疑问】关系数据如何保存？

  - 一对多 => 使用外键关联，保存在多方
  - 多对多 => 使用中间表关联，保存在中间表

- 【疑问】评论需要接入包管理机制吗？

- 【疑问】java 调用爬虫接口，获取大量评论数据 1，将数据 1 入库，得到数据 2，数据 1 有没有可能比数据 2 少？需要记录？

- 【持续优化】后端写接口流程

  整个后端接口使用 try catch 包裹，通过抛出异常的方式解决异常情况

  - controller 获取请求参数
    - 校验请求参数：使用 DTO 数据校验请求参数是否符合预期
  - service 使用请求参数
  - 返回响应数据
    - 使用 VO 定义响应数据结构

- for 循环使用

  - 找到第一个不符合条件 i
  - i - 1

- 【疑问】VO 是什么？

  view object 表示返回给前端的数据结构定义

- nest 完成开发 commit message

  - 快速生成单表操作模板代码
  - typeorm 连接数据库
  - 使用 typeorm 操作数据库

- 【存疑】如何定义 nest 的 column status 为 enum ？

- 

---

### 数据看板需求

- 用户可以选择一个时间或者两个时间 + 任务类型  + 分区
-  选择一个时间 =》 查看时间的数据
  - 制作总量（累积量）
  - top 覆盖度（当周的情况）
  - excel 其他数据的情况，注意区分需要获取累计量还是当周量

- 

---

### 上线权限

- 7：30 上
- 出现问题两种解决方案
  - 联系超级管理员
  - 重新将包分配给相关的人

---

## 2022.08.03 周三

### todo

- nest 、 sprintboot 完成 comment  + commentTask 数据表的操作，一共完成 comment 增删改查 4 个接口
- ✅ andy 问题
- AUDIT_AFTER_EDIT  andy 
- 思考如何实现增量
- all hands
- 租房
- ~~andy 数据看板优化~~
- 数据看板第一期需求确定



---

### AUDIT_AFTER_EDIT  andy 

- 假设一个

---

### 思考如何实现增量

用户批量将yid 数据放到 commentTask 表，使用另一个服务不断查询 commentTask  表status === pending的数据，然后执行入库操作



---

### all hands

- 低垂果实



### 租房

- 租多久？
- 最重要不吵
- 位置关注下一家





---

### andy 数据看板优化

- 每日制作
- 分区歌曲，in ES there are 1000 songs, 10% pending, 20% pending audit, 70% done. 



---

### 数据看板第一期需求确定

---



### 2022.08.04 周四

### todo

- 用户维度 + 任务维度数据静态



---

### 用户维度 + 任务维度数据静态

- 数据可视化最大的工作量是转化数据

- user

  - 表格字段修改

    ![image-20220805152434688](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220805152434688.png)

  - 表格删除（选做）

  - 新增 增量 - 全量切换按钮

  - 新增两个时间段的差额比较

- cycle

  - 选择 3 个时间，全量是 3 个点，增量也是 3 个点，不是 2 个点
  - 表格 ，柱状图，折线图，饼图四种形式互相切换
  - 新增两个时间段的差额比较

- 用户选择第一个时间段

  - 展示所选时间段的全量数据 - 折线图（四图互相切换）

- 点击全量 - 增量切换按钮

  - 展示所选时间段的增量数据 - 折线图（四图互相切换）（x 轴数量全量与增量数据保持一致）

- 用户选择第二个时间段

  - 使用 xxxxx 图表展示两个时间段的差额



## 2022.08.08 周一

### 本周 todo

- 数据看板
- 异步任务笔记
- java 增删改查



---



### todo

- fb 下载站登录模块调研文档编写
- 完成数据看板的技术文档



### fb 下载站登录模块调研文档编写

- 这里的 cookie 是响应信息还是请求信息？

  ![image-20220808084837254](https://raw.githubusercontent.com/wojiaofengzhongzhuifeng/iamge-host-2/master/image-20220808084837254.png)

  

  ---

  ### 数据看板技术文档

  #### 按照任务纬度的数据看板

  - [需要用到的接口](https://www.apifox.cn/web/project/956493/apis/api-33071640)

  - 用户的操作

    - 选择第一个时间段（不一定要一个周期，可以选择任意两个时间点）
    - 选择任务类型（META, LYRIC, TAG）
    - 区域
    - top 周期（只能选择某个周五 + 周四周期数据）
    - 点击全量 - 增量切换按钮
    - 选择第二个时间段，**第二个时间段的长度需要和第二个时间段保持一致**，表现形式与第一个时间段保持一致

  - 常用周期

    - 最旧：2022-07-08 ~ 2022-07-14
    - 较旧：2022-07-15 ~ 2022-07-21
    - 最新：2022-07-22 ~ 2022-07-28

  - 用户的操作生成的请求参数示例

    - 示例：查询 08-06 单日相对于 07-22~07-28 最新周期
    - 示例：查询 08-06 单日相对于 07-15~07-21 较旧周期
    - 示例：查询 08-06~08-07 多日相对于 07-22~07-28 最新周期 
    - 示例：查询 08-06~08-07 多日相对于 07-15~07-21 较旧周期

  - 接口请求数据含义

    - ❌ 有可能 lang === ALL ，但是响应有值？

  - 接口响应数据含义

    - "crawlPreciseTotal": 5150, // 已经审核数据中的爬取准确总数， ❌为什么08-06 07-22（9010） 与 08-06 07-15（5150） 差这么多，【疑问】只有 meta 有？

    - "auditCrawlTotal": 5909,【疑问】只有 meta 有？

    - "crawlTotal": 6197, // 爬取成功总数 【疑问】meta 通过 top 数据得到；lyric 和 tag 爬取总数取决于 meta 制作量

    - "crawlPreciseRate": 0.87, // 爬取准确率

      crawlPreciseRate = crawlPreciseTotal / auditCrawlTotal

    - "crawlRate": 0.62,

      crawlRate = crawlTotal / taskTotal

  - 页面结构

    - searchForm
    - table 总数
    - 可视化图表
      - total 分发总数 + taskTotal 任务总数
      - crawlRate 爬取率 + crawlPreciseRate 爬取准确率
      - cannotTotal 不可制作总数
      - balance1Total 差额总量1 + balance2Total 差额总量2 

    





---

### 2022.08.09 周二 

### todo 

- 解决 andy 问题
- 完成任务维度数据看板
- 【学习】使用数据看板模块，总结模块书写顺序，写一个 demo

---

### 解决 andy 问题

- 希望能区分歌词制作任务「完全没有歌词」和「只需要检查时间轴是否正确」类型
  - 使用 https://www.apifox.cn/web/project/956493/apis/api-25817861 接口查询？
  - transcription 听写歌词 、 synchronization 同步时间轴
- 现在如何开展分工？下面二选一
  - 没有歌词，国外翻译；国内检查时间轴
  - 没有歌词，国外翻译；国外检查时间轴

---

### 完成任务维度数据看板

- 正在完成需求，突然需要修改 bug ，应该如何处理

- searchForm 添加条件，如何修改代码？

- 选择一个时间段 08-02~08-03，选择增量数据看板后，需要查询 08-01 ~ 08-03 数据，用什么方式请求08-01 数据合适？

  新增 dataMonitorMode state，在 convertFrontToBackSearchForm 时，当  dataMonitorMode  === 增量模式，startDate往前请求一天；convertBackToFrontTaskDataMonitorList 同样进行判断，为增量模式，将原数据进行一次计算。











